---
import InputField from "@/components/InputField.astro";
import WordContainer from "@/components/WordContainer.astro";
import Layout from "@/layout/Layout.astro";
import { wordlib } from "@/lib/word-service";

const words: string[] = [];

if (Astro.request.method === "POST") {
  try {
    const data = await Astro.request.formData();
    const guessedWord = data.get("letters") as string;
    const mustIncludeLetters = data.get("extra-field-1") as string;
    const excludedLetters = data.get("extra-field-2") as string;

    const possibleWords = wordlib.getPossibleWords(guessedWord.toLowerCase());

    possibleWords.forEach((word) => {
      if (word.includes(":")) {
        return;
      }

      if (mustIncludeLetters !== "") {
        const mustIncludeLettersLowerCase = [
          ...mustIncludeLetters.toLowerCase(),
        ];
        if (!mustIncludeLettersLowerCase.every((c) => word.includes(c))) {
          return;
        }
      }

      if (excludedLetters !== "") {
        const excludedLettersLowerCase = [...excludedLetters.toLowerCase()];
        if (excludedLettersLowerCase.some((c) => word.includes(c))) {
          return;
        }
      }

      words.push(word);
    });
  } catch (error) {
    if (error instanceof Error) {
      console.error(error.message);
    }
  }
}
---

<Layout>
  <InputField
    service="ordlÃ¶s"
    details={["Enter unknown characters as '?', for example: P?L?T "]}
    mainInputFieldPlaceholder="your letters"
    additionalInputs={true}
  />

  <WordContainer result={words} />
</Layout>
